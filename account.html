<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Account Dashboard | Softwork Solutions</title>
  <link rel="stylesheet" href="styles.css" />
  <link rel="stylesheet" href="account-custom.css" />
  <script defer src="script.js"></script>
  <link rel="icon" href="logo-light.png" />
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.12.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.1/firebase-firestore-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCQsc-_nnGKlxHfhMBD4rIovrjLla0yp-4",
      authDomain: "software-solutions-f17c1.firebaseapp.com",
      projectId: "software-solutions-f17c1",
      storageBucket: "software-solutions-f17c1.appspot.com",
      messagingSenderId: "911290181585",
      appId: "1:911290181585:web:30109dccae395055aa62f0"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
  </script>
</head>

<body>
  <div class="cursor-ghost" id="ghost"></div>

  <!-- NAVIGATION -->
  <header class="navbar">
    <div class="nav-container">
      <div class="nav-left">
        <div class="logo">
          <img src="logo.png" alt="Logo" />
          <span>Softwork Solutions</span>
        </div>
      </div>
      <div class="mobile-only">
        <button class="menu-toggle" id="menu-toggle"><i data-lucide="menu"></i></button>
      </div>
      <div class="nav-center">
        <label class="theme-switch">
          <span class="icon light"><i data-lucide="sun"></i></span>
          <input type="checkbox" id="theme-toggle">
          <span class="slider"></span>
          <span class="icon dark"><i data-lucide="moon"></i></span>
        </label>
      </div>
      <div class="nav-right">
        <ul class="nav-links">
          <li><a href="index.html">Home</a></li>
          <li><a href="services.html">Services</a></li>
          <li><a href="about.html">About</a></li>
          <li><a href="contact.html">Contact</a></li>
        </ul>
        <button class="btn login-btn" onclick="logout()">Logout</button>
      </div>
    </div>
  </header>

  <!-- HERO SECTION -->
  <section class="hero">
    <canvas id="network-bg"></canvas>
    <div class="hero-inner">
      <h1>Welcome to Your Dashboard</h1>
      <p>Track your submissions and manage your profile</p>
    </div>
  </section>

  <!-- USER INFO -->
  <section class="container user-profile">
    <div id="loading-msg">Checking login status...</div>
    <div id="user-card" style="display: none;">
      <img id="user-pic" src="" alt="Profile Picture" />
      <div class="info">
        <h2 id="user-name"></h2>
        <p id="user-email"></p>
      </div>
    </div>
  </section>

  <!-- FORM TRACKER -->
  <section class="container tracker-section">
    <h2>ðŸ“„ Your Form Submissions</h2>
    <div id="form-submissions" class="submissions-grid">
      <p style="text-align: center;">Loading your submissions...</p>
    </div>
  </section>

  <!-- LOGOUT + FIREBASE HANDLER -->
  <script>
    firebase.auth().onAuthStateChanged(user => {
      const loadingMsg = document.getElementById("loading-msg");
      const userCard = document.getElementById("user-card");

      if (user) {
        loadingMsg.style.display = "none";
        userCard.style.display = "flex";
        localStorage.setItem("softwork_logged_in", "true");

        document.getElementById("user-pic").src = user.photoURL || 'default.png';
        document.getElementById("user-name").textContent = user.displayName || "User";
        document.getElementById("user-email").textContent = user.email;

        db.collection("onboarding_submissions")
          .where("email", "==", user.email)
          .orderBy("timestamp", "desc")
          .get()
          .then(snapshot => {
            const container = document.getElementById("form-submissions");
            container.innerHTML = "";

            if (snapshot.empty) {
              container.innerHTML = "<p style='text-align:center;'>No forms submitted yet.</p>";
              return;
            }

            snapshot.forEach(doc => {
              const data = doc.data();
              const div = document.createElement("div");
              div.className = "submission-card";

              const date = data.timestamp?.toDate().toLocaleString() || 'Unknown';
              const company = data.company_name || 'N/A';
              const status = data.status || 'Pending';

              div.innerHTML = `
                <div class="card-header">
                  <strong>${company}</strong>
                  <span class="status-badge ${status.toLowerCase()}">${status}</span>
                </div>
                <p><strong>Submitted:</strong> ${date}</p>
              `;
              container.appendChild(div);
            });
          })
          .catch(err => {
            document.getElementById("form-submissions").innerHTML = "<p style='text-align:center;'>Error loading forms.</p>";
            console.error(err);
          });
      } else {
        setTimeout(() => window.location.href = "login.html", 1000);
      }
    });

    function logout() {
      firebase.auth().signOut().then(() => {
        localStorage.removeItem("softwork_logged_in");
        window.location.href = "login.html";
      });
    }
  </script>
</body>
</html>
