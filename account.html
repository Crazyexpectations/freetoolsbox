<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Account Dashboard | Softwork Solutions</title>
  <link rel="stylesheet" href="services.css" />
  <script defer src="script.js"></script>
  <link rel="icon" href="logo-light.png" />
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.12.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.1/firebase-firestore-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCQsc-_nnGKlxHfhMBD4rIovrjLla0yp-4",
      authDomain: "software-solutions-f17c1.firebaseapp.com",
      projectId: "software-solutions-f17c1",
      storageBucket: "software-solutions-f17c1.appspot.com",
      messagingSenderId: "911290181585",
      appId: "1:911290181585:web:30109dccae395055aa62f0"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
  </script>
  <style>
    .form-card {
      background-color: #ffffff;
      color: #000;
      border: 1px solid #ddd;
      border-radius: 10px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.06);
      transition: transform 0.2s ease;
    }

    .form-card:hover {
      transform: translateY(-4px);
    }

    .form-card h3 {
      margin-bottom: 0.5rem;
      color: #005f99;
    }

    .form-card p {
      margin: 0.3rem 0;
      font-size: 0.95rem;
    }

    body.dark .form-card {
      background-color: #1e1e1e;
      color: #fff;
      border: 1px solid #444;
    }

    body.dark .form-card h3 {
      color: #00bcd4;
    }
  </style>
</head>

<body>
  <div class="cursor-ghost" id="ghost"></div>

  <!-- NAVBAR -->
  <header class="navbar">
    <!-- UNCHANGED -->
    <!-- ... same as before ... -->
  </header>

  <!-- HERO SECTION -->
  <section class="hero" style="position: relative;">
    <canvas id="network-bg" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1;"></canvas>
    <div class="hero-inner" style="position: relative; z-index: 2;">
      <h1>Welcome to Your Dashboard</h1>
      <p>Manage your profile and view your submissions</p>
    </div>
  </section>

  <!-- USER INFO -->
  <section class="container" style="text-align:center; margin-top: 2rem;">
    <p id="loading-msg">Checking login status...</p>
    <img id="user-pic" src="" alt="Profile Picture" style="width: 100px; border-radius: 50%; display:none;" />
    <h2 id="user-name" style="color: var(--text-color, #000);"></h2>
    <p id="user-email" style="color: var(--text-color, #000);"></p>
  </section>

  <!-- DASHBOARD / SUBMISSIONS -->
  <section class="container" style="margin-top: 3rem;">
    <h2 style="color: var(--text-color, #000); text-align:center;">Submitted Forms</h2>
    <div id="form-submissions" style="margin-top: 2rem;">Loading your submissions...</div>
  </section>

  <script>
    firebase.auth().onAuthStateChanged(user => {
      document.getElementById("loading-msg").style.display = "none";

      if (!user) {
        return setTimeout(() => window.location.href = "join.html", 1200);
      }

      // Display user info
      document.getElementById("user-pic").src = user.photoURL || 'default.png';
      document.getElementById("user-pic").style.display = "inline-block";
      document.getElementById("user-name").textContent = user.displayName || "User";
      document.getElementById("user-email").textContent = user.email;

      // Fetch form submissions
      db.collection("onboarding_submissions")
        .where("email", "==", user.email)
        .orderBy("timestamp", "desc")
        .get()
        .then(snapshot => {
          const container = document.getElementById("form-submissions");
          container.innerHTML = "";

          if (snapshot.empty) {
            container.innerHTML = "<p>No submissions found yet.</p>";
            return;
          }

          snapshot.forEach(doc => {
            const data = doc.data();
            const company = data.company_name || "N/A";
            const contact = data.contact_person || "N/A";
            const submitted = data.timestamp?.toDate().toLocaleString() || "Unknown";
            const projectTypes = Array.isArray(data.project_type) ? data.project_type.join(", ") : data.project_type_other || "N/A";

            const card = document.createElement("div");
            card.classList.add("form-card");
            card.innerHTML = `
              <h3>${company}</h3>
              <p><strong>Contact:</strong> ${contact}</p>
              <p><strong>Submitted:</strong> ${submitted}</p>
              <p><strong>Project Type:</strong> ${projectTypes}</p>
            `;
            container.appendChild(card);
          });
        })
        .catch(error => {
          console.error("Error fetching submissions:", error);
          document.getElementById("form-submissions").innerHTML = "<p style='color:red;'>Failed to load submissions.</p>";
        });
    });

    function logout() {
      firebase.auth().signOut().then(() => {
        window.location.href = "join.html";
      });
    }
  </script>
</body>
</html>
